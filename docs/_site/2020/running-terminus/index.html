<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <title>Running Terminus</title>
  <meta name="description" content=" Scripts for reproducing the the plots from the manuscript [New] 
Please follow the notebooks in terminus-scripts for producing the plots from the manuscript. This includes detailed steps from running salmon and mmcollapse along with specific parameters used in terminus.
">
  <meta name="author" content="Combine-lab (University Of Maryland)">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Running Terminus">
  <meta name="twitter:description" content=" Scripts for reproducing the the plots from the manuscript [New] 
Please follow the notebooks in terminus-scripts for producing the plots from the manuscript. This includes detailed steps from running salmon and mmcollapse along with specific parameters used in terminus.
">
  
  <meta name="twitter:creator" content="hrksrkr">
  
  <meta name="twitter:image" content="/terminus-tutorial/images/favicons/favicon-194x194.png" />

  <meta property="og:type" content="article">
  <meta property="og:title" content="Running Terminus">
  <meta property="og:description" content=" Scripts for reproducing the the plots from the manuscript [New] 
Please follow the notebooks in terminus-scripts for producing the plots from the manuscript. This includes detailed steps from running salmon and mmcollapse along with specific parameters used in terminus.
">
  <meta property="og:image" content="/terminus-tutorial/images/favicons/favicon-194x194.png" />

  <link rel="apple-touch-icon" sizes="57x57" href="/terminus-tutorial/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/terminus-tutorial/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/terminus-tutorial/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/terminus-tutorial/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/terminus-tutorial/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/terminus-tutorial/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/terminus-tutorial/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/terminus-tutorial/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/terminus-tutorial/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/terminus-tutorial/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/terminus-tutorial/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/terminus-tutorial/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/terminus-tutorial/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/terminus-tutorial/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/terminus-tutorial/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/terminus-tutorial/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/terminus-tutorial/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  <link rel="stylesheet" href="/terminus-tutorial/css/main.css?1586459502133490000">
  <link rel="canonical" href="http://localhost:4000/terminus-tutorial/2020/running-terminus/">
  <link rel="alternate" type="application/rss+xml" title="Terminus-Tutorial" href="/terminus-tutorial/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover" style="background-image: url(/terminus-tutorial/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/terminus-tutorial/#blog" title="link to home of /terminus-tutorial/#blog">
          <img src="/terminus-tutorial/images/profile.jpg" class="user-image" alt="My Profile Photo">
					<img src="/terminus-tutorial/images/logo.png" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Terminus-Tutorial</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">A support website for Terminus, a tool for finding data-driven, robust transcript groups from RNA-seq data</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/terminus-tutorial/tags/#Terminus" title="link to Terminus-Tutorial blog" class="blog-button">Tutorial</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">

            
              <!-- Twitter -->
              <li class="navigation__item">
                <a href="http://twitter.com/hrksrkr" title="@hrksrkr on Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>
            

            

            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/COMBINE-lab" title="COMBINE-lab on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:hsarkar@cs.umd.edu" title="Email hsarkar@cs.umd.edu" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
            

            <!-- RSS -->
            <!-- <li class="navigation__item">
              <a href="/terminus-tutorial/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li> -->

            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2020-02-01 10:04" class="post-meta__date date">1 Feb 2020</time>
      
      &#8226; <span class="post-meta__tags">on <a href="/terminus-tutorial/tags/#Terminus">Terminus</a> </span>
      
    </div>
    <h1 class="post-title">Running Terminus</h1>
  </header>

  <section class="post">
    <h2 id="-scripts-for-reproducing-the-the-plots-from-the-manuscript-new-"><span style="color:red"> Scripts for reproducing the the plots from the manuscript [<strong>New</strong>] </span></h2>
<p>Please follow the notebooks in <a href="https://github.com/COMBINE-lab/terminus-paper-scripts/tree/master/notebook">terminus-scripts</a> for producing the plots from the manuscript. This includes detailed steps from running <code class="highlighter-rouge">salmon</code> and <code class="highlighter-rouge">mmcollapse</code> along with specific parameters used in <code class="highlighter-rouge">terminus</code>.</p>

<h2 id="a-challenge-for-accurate-rna-seq-analysis">A challenge for accurate RNA-seq analysis</h2>

<p>RNA-seq analysis is most often carried out at the gene level, which can provide robust estimates of the total
transcriptional output of a set of related transcripts, but which can mask differences in differential isoform usage
between conditions.  Moreover, in the presence of highly-sequence-similar gene families, these estimates may not 
be accurate.  On the other hand, transcript-level analysis provides exquisite biological resolution, but is often beyond
the bounds of robust inference for some fraction of the transcriptome.  In such cases, maximum likelihood estimation (MLE)-based models are prone to return a high-likelihood but likely incorrect solution.  Such ambiguity is inherent in the RNA-seq data and in the inference challenge it poses, and results chiefly from multi-mapping reads induced by sequence similarity between transcripts due either to alternative splicing or to sequence-similarity among related genes within larger gene families.</p>

<h2 id="what-is-terminus">What is Terminus?</h2>

<p>Terminus is a program that implements a new method for analyzing transcript-level abundance estimates from RNA-seq data. Terminus works downstream of salmon, and collapses individual transcripts into groups whose total transcriptional output can be estimated more accurately and robustly.</p>

<h2 id="approach-of-terminus">Approach of Terminus</h2>

<p>Terminus attempts to solve this problem of grouping transcripts by using information drawn from the posterior distribution of transcript abundance estimates (i.e. Gibbs samples), not just the point estimate. The groups computed by terminus represent abundance estimation reported at the resolution that is actually supported by the underlying experimental data. In a typical experiment, this is neither at the gene level nor the transcript level. Some transcripts, even from complex, multi-isoform genes, can have their abundances confidently estimated, while other transcripts cannot. Rather than pre-defining the resolution at which the analysis will be performed, and subjecting the results to unnecessary uncertainty or insufficient biological resolution, terminus allows the determination of transcriptional groups that can be confidently ascertained in a given sample, and represents, in this sense, a data-driven approach to transcriptome analysis.</p>

<h2 id="how-to-build-terminus">How to build terminus</h2>

<p>Terminus uses the <a href="https://github.com/rust-lang/cargo">cargo</a> build system and package manager. To build terminus from source, you will need to have rust (ideally v1.40 or greater) installed. Then, you can build terminus by executing:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cargo</span> <span class="n">build</span> <span class="o">--</span><span class="n">release</span>
</code></pre></div></div>

<h2 id="how-terminus-works">How Terminus works</h2>
<p>At this moment Terminus works on the output of <a href="https://github.com/COMBINE-lab/salmon">salmon</a>. Additionally 
salmon should be run with <code class="highlighter-rouge">--numGibbsSamples &lt;number of samples&gt;</code> so that it writes the posterior Gibbs samples. Additionally there is also <code class="highlighter-rouge">-d</code> command that needs to be provided for for writing the equivalence classes to the output, that is later used by Terminus. Terminus
works with two subcommands, <code class="highlighter-rouge">group</code> and <code class="highlighter-rouge">collapse</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">terminus</span> <span class="n">group</span> <span class="o">-</span><span class="n">m</span> <span class="o">&lt;</span><span class="n">float</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">tolerance</span> <span class="o">&lt;</span><span class="n">float</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">d</span> <span class="o">&lt;</span><span class="n">salmon_dir</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">out_dir</span><span class="o">&gt;</span>
</code></pre></div></div>
<p>For collapsing,</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">terminus</span> <span class="n">collapse</span> <span class="o">-</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">float</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">d</span> <span class="o">&lt;</span><span class="n">salmon_dir</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">out_dir</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Note that terminus first writes some auxiliary files in the <code class="highlighter-rouge">&lt;out_dir&gt;</code> and afterwards in the collapsing phase writes down the final collapsed quantification values along with other metadata files.</p>

<h2 id="how-to-use-deseq2-in-the-downstream-to-identify-differentially-expressed-groups">How to use DESeq2 in the downstream to identify differentially expressed groups</h2>

<p>Currently the transcript to group mapping can be used as a proxy for finding out gene level differentially expressed groups. The trick is to use the <code class="highlighter-rouge">tximport</code> module originally intended for converting transcript level expression to gene level expression.</p>

<p>To create the transcript to group csv file (as a proxy to the transcript to gene csv file)</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">python</span> <span class="n">scripts</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">extract_txp_group</span><span class="p">.</span><span class="nf">py</span> <span class="o">&lt;</span><span class="n">salmon_quant_file</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">terminus_out</span><span class="o">&gt;</span><span class="sr">/cluster.txt txp.group.csv
</span></code></pre></div></div>

<p>This <code class="highlighter-rouge">txp.group.csv</code> can be then used in <code class="highlighter-rouge">DESeq2</code> as follows. Given the 4x4 polyester samples discussed in the manuscript a typical pipeline for DE analysis would go as follows,</p>

<p>The required packages are,</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tximport</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">DESeq2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>Check the existence of files</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">csv.dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"/mnt/scratch1/hirak/ASE_Analysis/simulation/deseq2"</span><span class="w">
</span><span class="n">samps</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">csv.dir</span><span class="p">,</span><span class="s2">"samples.csv"</span><span class="p">))</span><span class="w">

</span><span class="n">files</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="s2">"/mnt/scratch1/hirak/ASE_Analysis/simulation/quant_witohut_decoy"</span><span class="p">,</span><span class="w"> </span><span class="n">samps</span><span class="o">$</span><span class="n">sample_id</span><span class="p">,</span><span class="w"> </span><span class="s2">"quant.sf"</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">samps</span><span class="o">$</span><span class="n">sample_id</span><span class="w">
</span><span class="nf">all</span><span class="p">(</span><span class="n">file.exists</span><span class="p">(</span><span class="n">files</span><span class="p">))</span><span class="w">

</span><span class="n">tx2gene</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="w">
    </span><span class="n">file.path</span><span class="p">(</span><span class="s2">"/mnt/scratch1/hirak/ASE_Analysis/simulation/deseq2/txp2group.csv"</span><span class="p">),</span><span class="w">
    </span><span class="n">col_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"TNAME"</span><span class="p">,</span><span class="s2">"GNAME"</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">tx2gene</span><span class="p">)</span><span class="w">


</span><span class="n">txi</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tximport</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"salmon"</span><span class="p">,</span><span class="w"> </span><span class="n">tx2gene</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx2gene</span><span class="p">,</span><span class="w"> </span><span class="n">countsFromAbundance</span><span class="o">=</span><span class="s2">"lengthScaledTPM"</span><span class="p">)</span><span class="w">
</span><span class="n">dds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">DESeqDataSetFromTximport</span><span class="p">(</span><span class="n">txi</span><span class="p">,</span><span class="w"> </span><span class="n">samps</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">condition</span><span class="p">)</span><span class="w">
</span><span class="n">dds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">DESeq</span><span class="p">(</span><span class="n">dds</span><span class="p">)</span><span class="w">
</span><span class="n">dres</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">DESeq2</span><span class="o">::</span><span class="n">results</span><span class="p">(</span><span class="n">dds</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<p><code class="highlighter-rouge">dds</code> and <code class="highlighter-rouge">dres</code> are general DESeq2 objects that can further be analyzed as described in <a href="http://bioconductor.org/packages/release/bioc/vignettes/DESeq2/inst/doc/DESeq2.html">Analyzing RNA-seq data with DESeq2</a>.</p>


  </section>
  
</article>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2020 Combine-lab (University Of Maryland). All rights reserved.</span>
</footer>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="/terminus-tutorial/js/main.js?1586459502133490000"></script>


    </div>
  </body>
</html>